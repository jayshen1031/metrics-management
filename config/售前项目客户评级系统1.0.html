<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>售前项目客户评级系统 - Caroline</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* 
         * 售前客户评级系统CSS
         * 设计：caroline
         */
        :root {
            --level-1: 1.3rem;   /* 主标题 */
            --level-2: 1.1rem;   /* 主分类 */
            --level-3: 1.0rem;   /* 字段标签 */
            --level-4: 0.95rem;  /* 选项文字 */
            --level-5: 0.85rem;  /* 描述文字 caroline */
            --result-title: 1.4rem;
            --result-score: 2.8rem;
            --result-table: 0.95rem;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            padding-top: 15px;
            padding-bottom: 30px;
            color: #333;
            position: relative;
            
            /* 添加背景水印 - caroline */
                  45deg,
                  rgba(220, 220, 220, 0.25) 25%,
                  transparent 25%,
                  transparent 75%,
                  rgba(220, 220, 220, 0.25) 75%,
                  rgba(220, 220, 220, 0.25)
                ),
                linear-gradient(
                  45deg,
                  rgba(220, 220, 220, 0.25) 25%,
                  transparent 25%,
                  transparent 75%,
                  rgba(220, 220, 220, 0.25) 75%,
                  rgba(220, 220, 220, 0.25)
                );
            background-size: 300px 300px;
            background-position: 0 0, 150px 150px;
        }
        
        .header-container {
            background: linear-gradient(to right, #1a2980, #26d0ce);
            padding: 22px 0;
            margin-bottom: 20px;
            color: white;
            border-bottom: 5px solid #3498db;
        }
        
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* 添加水印元素 - caroline */
        .watermark {
            position: fixed;
            bottom: 10px;
            right: 10px;
            font-size: 14px;
            color: rgba(0, 0, 0, 0.4);
            z-index: 9999;
            font-family: Arial, sans-serif;
            font-weight: bold;
            pointer-events: none;
            user-select: none;
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            border: none;
            background: white;
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 0 6px 15px rgba(0,0,0,0.12);
        }
        
        .card-header {
            background: #3498db;
            color: white;
            font-weight: 600;
            font-size: var(--level-2);
            border-radius: 10px 10px 0 0 !important;
            padding: 14px 18px;
            border: none;
        }
        
        .section-title {
            position: relative;
            padding-left: 15px;
            margin-bottom: 14px;
            color: #1a2980;
            font-weight: 600;
            font-size: var(--level-2);
            border-bottom: 2px solid #eef2f7;
            padding-bottom: 8px;
        }
        
        .rating-option {
            padding: 14px;
            margin-bottom: 10px;
            border-radius: 8px;
            background-color: #f8f9fa;
            border: 1px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: var(--level-4);
        }
        
        .rating-option:hover {
            background-color: #e3f2fd;
            border-color: #3498db;
        }
        
        .rating-option.selected {
            background-color: #d1e9ff;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.25);
        }
        
        .score-display {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 14px;
            font-weight: 600;
            text-align: center;
            font-size: var(--level-3);
            color: #2c3e50;
            margin-bottom: 20px;
            border: 1px solid #bbdefb;
        }
        
        .level-badge {
            font-size: 1.1rem;
            font-weight: bold;
            padding: 8px 18px;
            border-radius: 25px;
            display: inline-block;
        }
        
        .a-plus-bg {
            background: #27ae60;
            color: white;
        }
        
        .a-bg {
            background: #3498db;
            color: white;
        }
        
        .b-bg {
            background: #f39c12;
            color: white;
        }
        
        .c-bg {
            background: #e74c3c;
            color: white;
        }
        
        .weight-tag {
            display: inline-block;
            background-color: #d1ecfa;
            color: #2c6da0;
            padding: 2px 8px;
            border-radius: 15px;
            font-size: var(--level-5);
            margin-left: 6px;
            font-weight: 600;
        }
        
        .form-label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: var(--level-3);
        }
        
        .total-score {
            font-size: var(--result-score);
            font-weight: 900;
            color: #3498db;
            text-align: center;
            margin: 15px 0;
            line-height: 1.1;
        }
        
        .export-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            font-weight: 600;
            border-radius: 8px;
            width: 100%;
            margin-top: 20px;
            transition: background 0.3s ease;
            font-size: var(--level-3);
        }
        
        .export-btn:hover {
            background: #2980b9;
        }
        
        .system-rules {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #3498db;
            font-size: var(--level-4);
        }
        
        /* 字体层级控制 */
        .option-desc {
            font-size: var(--level-5);
            color: #666;
            margin-top: 5px;
            margin-bottom: 0;
            line-height: 1.4;
        }
        
        .hierarchy-info {
            font-size: var(--level-5);
            color: #777;
            display: block;
            margin-bottom: 10px;
        }
        
        .input-control {
            font-size: var(--level-4);
        }
        
        .result-table {
            font-size: var(--result-table);
        }
        
        .result-title {
            font-size: var(--result-title);
            color: #1a2980;
        }
        
        @media (max-width: 992px) {
            .header-container {
                padding: 18px 0;
            }
            
            .card {
                margin-bottom: 15px;
            }
        }
        
        @media (max-width: 768px) {
            :root {
                --level-1: 1.2rem;
                --level-2: 1.0rem;
                --level-3: 0.95rem;
                --level-4: 0.9rem;
                --level-5: 0.8rem;
                --result-title: 1.2rem;
                --result-score: 2.2rem;
                --result-table: 0.85rem;
            }
            
            .section-title {
                font-size: var(--level-2);
                margin-bottom: 12px;
            }
            
            .rating-option {
                padding: 12px;
                font-size: var(--level-4);
            }
        }
        
        /* 兼容Edge浏览器的特殊样式 */
        @supports (-ms-ime-align: auto) {
            body {
                font-family: 'Segoe UI', 'Segoe UI Web (West European)', sans-serif;
            }
        }
        
        .info-icon {
            color: #3498db;
            margin-right: 8px;
            font-size: 1.1rem;
        }
        
        .form-control, .form-select {
            padding: 8px 12px;
            font-size: var(--level-4);
        }
    </style>
</head>
<body>
    <div class="header-container">
        <div class="container">
            <div class="text-center mb-3">
                <h1 style="font-size: 1.8rem;"><i class="bi bi-bar-chart-line"></i> 售前项目客户评级系统</h1>
                <p class="mb-0">基于风险把控的客户准入与资信评估</p>
            </div>
            <div class="d-flex justify-content-center flex-wrap mt-3">
                <div class="d-flex align-items-center me-4 mb-2">
                    <span class="level-badge a-plus-bg me-2">A+</span>
                    <span>评分≥90</span>
                </div>
                <div class="d-flex align-items-center me-4 mb-2">
                    <span class="level-badge a-bg me-2">A</span>
                    <span>80-89分</span>
                </div>
                <div class="d-flex align-items-center me-4 mb-2">
                    <span class="level-badge b-bg me-2">B</span>
                    <span>70-79分</span>
                </div>
                <div class="d-flex align-items-center mb-2">
                    <span class="level-badge c-bg me-2">C</span>
                    <span>评分<70</span>
                </div>
            </div>
        </div>
    </div>

    <div class="container main-container">
        <div class="row g-4">
            <!-- 主评分表单 -->
            <div class="col-lg-7">
                <div class="card">
                    <div class="card-header">
                        <i class="bi bi-pencil-square me-2"></i> 客户评分表单
                    </div>
                    <div class="card-body">
                        <form id="mainRatingForm">
                            <div class="row mb-4">
                                <div class="col-md-6 mb-3">
                                    <label for="customerName" class="form-label">
                                        <i class="info-icon bi bi-buildings"></i> 客户名称
                                    </label>
                                    <input type="text" class="form-control input-control" id="customerName" required placeholder="请输入客户全称">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="customerType" class="form-label">
                                        <i class="info-icon bi bi-people"></i> 客户类型
                                    </label>
                                    <select class="form-select input-control" id="customerType" required>
                                        <option value="">-- 请选择客户类型 --</option>
                                        <option value="direct">直接客户</option>
                                        <option value="global">Global同行客户</option>
                                        <option value="overseas">海外代理客户</option>
                                        <option value="peer">同行客户</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h5 class="section-title"><i class="bi bi-building me-2"></i> 1. 行业 （权重10%）</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="rating-option" data-target="strategicIndustry">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="industryType" value="10" id="strategicIndustry" required>
                                                <label class="form-check-label" for="strategicIndustry">
                                                    战略行业 <span class="weight-tag">10分</span>
                                                    <p class="option-desc">电子科技/半导体/汽车及配件/电池储能/电商</p>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="rating-option" data-target="nonStrategicIndustry">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="industryType" value="5" id="nonStrategicIndustry">
                                                <label class="form-check-label" for="nonStrategicIndustry">
                                                    非战略行业 <span class="weight-tag">5分</span>
                                                    <p class="option-desc">除战略行业之外的其他行业</p>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h5 class="section-title"><i class="bi bi-diagram-3 me-2"></i> 2. 业务类型 （权重15%）</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="rating-option" data-target="combinedBusiness">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="businessType" value="15" id="combinedBusiness" required>
                                                <label class="form-check-label" for="combinedBusiness">
                                                    组合型业务 <span class="weight-tag">15分</span>
                                                    <p class="option-desc">多类型物流业务组合</p>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="rating-option" data-target="singleBusiness">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="businessType" value="12" id="singleBusiness">
                                                <label class="form-check-label" for="singleBusiness">
                                                    非组合型业务 <span class="weight-tag">12分</span>
                                                    <p class="option-desc">单一物流或相关业务</p>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h5 class="section-title"><i class="bi bi-person-lines-fill me-2"></i> 3. 客户情况 （权重55%）</h5>
                                
                                <div class="mb-4">
                                    <label class="form-label d-block">
                                        <i class="info-icon bi bi-star"></i> 客户影响力 （权重10%）
                                    </label>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="rating-option" data-target="influence1">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="influence" value="10" id="influence1" required>
                                                    <label class="form-check-label" for="influence1">
                                                        世界500强 /中国500强 /上市公司 /国企央企 <span class="weight-tag">10分</span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="rating-option" data-target="influence2">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="influence" value="8" id="influence2">
                                                    <label class="form-check-label" for="influence2">
                                                        民企500强 <span class="weight-tag">8分</span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="rating-option" data-target="influence3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="influence" value="4" id="influence3">
                                                    <label class="form-check-label" for="influence3">
                                                        其他 <span class="weight-tag">4分</span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="form-label d-block">
                                        <i class="info-icon bi bi-graph-up"></i> 客户物流费规模 （权重10%）
                                    </label>
                                    <div class="row">
                                        <div class="col-6 col-md-3">
                                            <div class="rating-option" data-target="scale1">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="logisticsScale" value="10" id="scale1" required>
                                                    <label class="form-check-label" for="scale1">
                                                        ≥1亿 <span class="weight-tag">10分</span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-3">
                                            <div class="rating-option" data-target="scale2">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="logisticsScale" value="8" id="scale2">
                                                    <label class="form-check-label" for="scale2">
                                                        5000万-1亿 <span class="weight-tag">8分</span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-3">
                                            <div class="rating-option" data-target="scale3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="logisticsScale" value="6" id="scale3">
                                                    <label class="form-check-label" for="scale3">
                                                        1000万-5000万 <span class="weight-tag">6分</span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-3">
                                            <div class="rating-option" data-target="scale4">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="logisticsScale" value="4" id="scale4">
                                                    <label class="form-check-label" for="scale4">
                                                        <1000万 <span class="weight-tag">4分</span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 资信评分区域 -->
                                <div class="mb-4">
                                    <label class="form-label d-block">
                                        <i class="info-icon bi bi-shield"></i> 客户资信评分 （权重25%）
                                    </label>
                                    <div class="alert alert-info py-2" style="font-size: var(--level-4);">
                                        <i class="bi bi-info-circle me-2"></i> 点击下方按钮填写资信评分表
                                    </div>
                                    <div class="row">
                                        <div class="col">
                                            <div class="d-flex justify-content-between align-items-center p-3 rounded" style="background-color: #e3f2fd; font-size: var(--level-4);">
                                                <div>
                                                    <span id="creditRatingDisplay">请填写资信评分表</span>
                                                </div>
                                                <button type="button" class="btn btn-primary input-control" data-bs-toggle="modal" data-bs-target="#creditRatingModal">
                                                    <i class="bi bi-pencil"></i> 填写资信评分
                                                </button>
                                            </div>
                                            <input type="hidden" name="creditRating" id="creditRating" value="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h5 class="section-title"><i class="bi bi-cash-coin me-2"></i> 4. 商机预估 （权重20%）</h5>
                                <div class="row g-2">
                                    <div class="col-md-3 col-6">
                                        <div class="rating-option" data-target="profit1">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="profitEstimate" value="20" id="profit1" required>
                                                <label class="form-check-label" for="profit1">
                                                     ≥1亿营收或≥500万毛利 <span class="weight-tag">20分</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3 col-6">
                                        <div class="rating-option" data-target="profit2">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="profitEstimate" value="10" id="profit2">
                                                <label class="form-check-label" for="profit2">
                                                    ≥100万毛利 <span class="weight-tag">10分</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3 col-6">
                                        <div class="rating-option" data-target="profit3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="profitEstimate" value="5" id="profit3">
                                                <label class="form-check-label" for="profit3">
                                                    ≥60万毛利 <span class="weight-tag">5分</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3 col-6">
                                        <div class="rating-option" data-target="profit4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="profitEstimate" value="2" id="profit4">
                                                <label class="form-check-label" for="profit4">
                                                    ≥12万毛利 <span class="weight-tag">2分</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                             <div class="col-md-3 col-6">
                                        <div class="rating-option" data-target="profit5">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="profitEstimate" value="0" id="profit5">
                                                <label class="form-check-label" for="profit5">
                                                    ＜12万毛利 <span class="weight-tag">0分</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex gap-3 mt-5">
                                <button type="reset" class="btn btn-secondary flex-grow-1 py-2">
                                    <i class="bi bi-arrow-clockwise me-2"></i> 重置表单
                                </button>
                                <button type="submit" class="btn btn-primary flex-grow-1 py-2">
                                    <i class="bi bi-calculator me-2"></i> 计算总分
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- 评分结果 -->
            <div class="col-lg-5">
                <div class="card h-100">
                    <div class="card-header">
                        <i class="bi bi-graph-up me-2"></i> 评分结果
                    </div>
                    <div class="card-body">
                        <div id="resultSection" class="d-none">
                            <div class="text-center mb-4">
                                <h3 class="result-title">客户综合评分结果</h3>
                            </div>
                            
                            <div class="d-flex justify-content-between mb-3">
                                <span class="fw-bold">客户名称：</span>
                                <span id="resultCustomerName" class="fw-bold"></span>
                            </div>
                            
                            <div class="d-flex justify-content-between mb-4 pb-3 border-bottom">
                                <span class="fw-bold">客户类型：</span>
                                <span id="resultCustomerType" class="fw-bold"></span>
                            </div>
                            
                            <div class="table-responsive mb-4">
                                <table class="table table-striped result-table">
                                    <thead>
                                        <tr>
                                            <th>评分项目</th>
                                            <th class="text-end">得分</th>
                                            <th class="text-end">权重</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>行业评分</td>
                                            <td class="text-end fw-bold" id="resultIndustry">0分</td>
                                            <td class="text-end">10%</td>
                                        </tr>
                                        <tr>
                                            <td>业务类型评分</td>
                                            <td class="text-end fw-bold" id="resultBusinessType">0分</td>
                                            <td class="text-end">15%</td>
                                        </tr>
                                        <tr>
                                            <td>客户影响力评分</td>
                                            <td class="text-end fw-bold" id="resultInfluence">0分</td>
                                            <td class="text-end">10%</td>
                                        </tr>
                                        <tr>
                                            <td>客户类型评分</td>
                                            <td class="text-end fw-bold" id="resultClientType">0分</td>
                                            <td class="text-end">10%</td>
                                        </tr>
                                        <tr>
                                            <td>客户规模评分</td>
                                            <td class="text-end fw-bold" id="resultLogisticsScale">0分</td>
                                            <td class="text-end">10%</td>
                                        </tr>
                                        <tr>
                                            <td>资信评分</td>
                                            <td class="text-end fw-bold" id="resultCredit">0分</td>
                                            <td class="text-end">25%</td>
                                        </tr>
                                        <tr>
                                            <td>商机预估评分</td>
                                            <td class="text-end fw-bold" id="resultProfit">0分</td>
                                            <td class="text-end">20%</td>
                                        </tr>
                                    </tbody>
                                    <tfoot class="table-primary">
                                        <tr>
                                            <th>总分</th>
                                            <td class="text-end fw-bold" id="resultTotalScore">0分</td>
                                            <td class="text-end">100%</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                            
                            <div class="d-flex justify-content-center align-items-center mb-4">
                                <span class="fs-4 fw-bold me-3">客户等级：</span>
                                <span class="level-badge" id="resultGrade">-</span>
                            </div>
                            
                            <div class="alert" id="resultMessage" style="font-size: var(--level-4);">
                                <i class="bi bi-info-circle me-2"></i>
                                <span id="resultMessageText">评级结果将显示在这里...</span>
                            </div>
                            
                            <button class="btn export-btn mt-3">
                                <i class="bi bi-file-earmark-spreadsheet me-2"></i> 导出Excel报告
                            </button>
                        </div>
                        
                        <div id="emptyResult" class="d-flex flex-column justify-content-center align-items-center py-5">
                            <div class="mb-4">
                                <i class="bi bi-clipboard text-muted" style="font-size: 4rem; opacity: 0.5;"></i>
                            </div>
                            <h5 class="text-muted mb-3">填写表单查看结果</h5>
                            <p class="text-muted mb-4 text-center" style="font-size: var(--level-4);">请完整填写左侧表单内容<br>系统将自动计算评分结果</p>
                            <div class="system-rules w-100 mt-3">
                                <h6 style="font-size: var(--level-3);"><i class="bi bi-info-circle me-2"></i> 系统规则说明</h6>
                                <ul class="mt-2" style="font-size: var(--level-5); padding-left: 20px;">
                                    <li class="mt-1">同行客户等级最高不超过C级</li>
                                    <li class="mt-1">资信评分低于65分的需领导审批</li>
                                    <li class="mt-1">A级及以上客户可享最优支持政策</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    
    <!-- 资信评分模态框 -->
    <div class="modal fade" id="creditRatingModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-clipboard2-data me-2"></i> 客户资信评分表</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info mb-4 py-2" style="font-size: var(--level-4);">
                        <i class="bi bi-info-circle me-2"></i> 填写本表后，评分将自动映射到主评分表的资信评分项
                    </div>
                    
                    <form id="creditRatingForm">
                        <!-- 基本信息部分 -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="section-title"><i class="bi bi-info-circle me-2"></i> 一、基本信息（权重35%）</h5>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label" style="font-size: var(--level-4);">企业性质（权重10%）</label>
                                <select class="form-select input-control" name="enterpriseNature">
                                    <option value=“”>--请选择企业性质--</option>
                                    <option value="8">合资企业 (8分)</option>
                                    <option value="8">独资企业 (8分)</option>
                                    <option value="10">国有企业 (10分)</option>
                                    <option value="6">民营企业 (6分)</option>
                                    <option value="6">私营企业 (6分)</option>
                                    <option value="3">其他 (3分)</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label" style="font-size: var(--level-4);">注册资本（权重10%）</label>
                                <select class="form-select input-control" name="registeredCapital">
                                    <option value=“”>--请选择注册资本--</option>
                                    <option value="10">≥RMB1亿 (10分)</option>
                                    <option value="8">RMB1000万-1亿 (8分)</option>
                                    <option value="6">RMB500万-1000万 (6分)</option>
                                    <option value="3">＜RMB500万 (3分)</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label" style="font-size: var(--level-4);">实缴资本（权重10%）</label>
                                <select class="form-select input-control" name="paidInCapital">
                                    <option value=“”>--请选择实缴资本--</option>
                                    <option value="10">≥RMB1亿 (10分)</option>
                                    <option value="8">RMB1000万-1亿 (8分)</option>
                                    <option value="6">RMB500万-1000万 (6分)</option>
                                    <option value="3">＜RMB500万 (3分)</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label" style="font-size: var(--level-4);">是否为生产企业（权重5%）</label>
                                <select class="form-select input-control" name="isManufacturer">
                                    <option value=“”>--是否生产企业--</option>
                                    <option value="5">是 (5分)</option>
                                    <option value="2">否 (2分)</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- 经营状态部分 -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="section-title"><i class="bi bi-graph-up me-2"></i> 二、经营状态（权重40%）</h5>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label" style="font-size: var(--level-4);">主营业务收入（权重10%）</label>
                                <select class="form-select input-control" name="mainBusinessIncome">
                                    <option value=“”>--请选择主营业务收入--</option>
                                    <option value="10">≥RMB10亿/年 (10分)</option>
                                    <option value="8">RMB1亿-10亿/年 (8分)</option>
                                    <option value="5">RMB5000万-1亿/年 (5分)</option>
                                    <option value="3">RMB1000万-5000万/年 (3分)</option>
                                    <option value="2">＜RMB1000万/年 (2分)</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label" style="font-size: var(--level-4);">主要供应商（权重5%）</label>
                                <select class="form-select input-control" name="mainSupplier">
                                    <option value=“”>--请选择主要供应商--</option>
                                    <option value="5">国企央企/上市企业/外资企业 (5分)</option>
                                    <option value="3">民企/自然人 (3分)</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label" style="font-size: var(--level-4);">付款方式（权重10%）</label>
                                <select class="form-select input-control" name="paymentMethod">
                                    <option value=“”>--请选择付款方式--</option>
                                    <option value="10">现金/转账/电汇 (10分)</option>
                                    <option value="5">支票/汇票/银行承兑 (5分)</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label" style="font-size: var(--level-4);">账期（权重10%）</label>
                                <select class="form-select input-control" name="accountPeriod">
                                    <option value=“”>--请选择账期--</option>
                                    <option value="10">票结/预付/15天 (10分)</option>
                                    <option value="9">30天/45天 (9分)</option>
                                    <option value="8">60天 (8分)</option>
                                    <option value="7">90天 (7分)</option>
                                    <option value="5">＞90天 (5分)</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label" style="font-size: var(--level-4);">成立年限（权重5%）</label>
                                <select class="form-select input-control" name="yearsEstablished">
                                    <option value=“”>--请选择成立年限--</option>
                                    <option value="5">≥10年 (5分)</option>
                                    <option value="3">2-10年 (3分)</option>
                                    <option value="1">＜2年 (1分)</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- 信用记录部分 -->
                        <div class="row">
                            <div class="col-12 mb-3">
                                <h5 class="section-title"><i class="bi bi-shield-check me-2"></i> 三、信用记录（权重25%）</h5>
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <label class="form-label" style="font-size: var(--level-4);">抵押担保情况（权重5%）</label>
                                <select class="form-select input-control" name="mortgageGuarantee">
                                    <option value="5">无 (5分)</option>
                                    <option value="2">有 (2分)</option>
                                </select>
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <label class="form-label" style="font-size: var(--level-4);">失信记录（权重6%）</label>
                                <select class="form-select input-control" name="dishonestyRecord">
                                    <option value="6">无 (6分)</option>
                                    <option value="3">有，已解除 (3分)</option>
                                    <option value="0">有，尚未解除 (0分)</option>
                                </select>
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <label class="form-label" style="font-size: var(--level-4);">工商处罚记录（权重8%）</label>
                                <select class="form-select input-control" name="penaltyRecord">
                                    <option value="8">无 (8分)</option>
                                    <option value="6">有，单次 (6分)</option>
                                    <option value="0">有，两次及以上 (0分)</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label" style="font-size: var(--level-4);">付款信用情况（权重4%）</label>
                                <select class="form-select input-control" name="paymentCredit">
                                    <option value="4">付款及时，信用良好 (4分)</option>
                                    <option value="0">付款口碑差 (0分)</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label" style="font-size: var(--level-4);">客户同行评价（权重2%）</label>
                                <select class="form-select input-control" name="peerReview">
                                    <option value="2">评价良好 (2分)</option>
                                    <option value="0">评价一般 (0分)</option>
                                </select>
                            </div>
                        </div>
                    </form>
                    
                    <div class="card mt-4">
                        <div class="card-body text-center">
                            <h6 class="card-title" style="font-size: var(--level-3);">当前资信评分结果</h6>
                            <div class="d-flex justify-content-center align-items-center">
                                <div class="score-display px-4 py-3 w-100">
                                    <div class="fs-2 fw-bold" id="creditTotalScore">0</div>
                                    <div class="mt-2">等级: <span class="fw-bold" id="creditLevel">未计算</span></div>
                                </div>
                            </div>
                            <div class="alert alert-warning mt-4 mb-0 py-2">
                                <i class="bi bi-exclamation-triangle me-2"></i> 
                                <span style="font-size: var(--level-5);">客户资质评分＜65分的由直属领导审批后方可开展业务</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary input-control" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary input-control" id="saveCreditRating">保存评分</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // 全局变量存储资信评分值
        let creditRating = 0;
        let creditRatingText = "请填写资信评分表";
        
        // DOM加载完成后执行代码
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化选项选择功能
            initOptionSelection();
            
            // 为资信评分表单添加变更事件
            document.getElementById('creditRatingForm').addEventListener('change', calculateCreditScore);
            
            // 保存资信评分
            document.getElementById('saveCreditRating').addEventListener('click', saveCreditRating);
            
            // 主表单提交事件
            document.getElementById('mainRatingForm').addEventListener('submit', calculateTotalScore);
            
            // Excel导出事件
            document.querySelector('.export-btn').addEventListener('click', exportToExcel);
            
            // 重置表单事件
            document.querySelector('button[type="reset"]').addEventListener('click', resetForm);
            
            // 显示空结果界面
            document.getElementById('emptyResult').classList.remove('d-none');
        });

        // 初始化选项选择功能
        function initOptionSelection() {
            var ratingOptions = document.querySelectorAll('.rating-option');
            for (var i = 0; i < ratingOptions.length; i++) {
                ratingOptions[i].addEventListener('click', function() {
                    var targetId = this.getAttribute('data-target');
                    if (targetId) {
                        // 移除所有同类选项的选择样式
                        var options = document.querySelectorAll('.rating-option');
                        for (var j = 0; j < options.length; j++) {
                            options[j].classList.remove('selected');
                        }
                        // 添加当前选项的选择样式
                        this.classList.add('selected');
                        
                        // 点击对应的单选按钮
                        var input = document.getElementById(targetId);
                        if (input) {
                            input.checked = true;
                        }
                    }
                });
            }
        }

        // 保存资信评分
        function saveCreditRating() {
            calculateCreditScore();
            
            // 更新主表单资信评分
            document.getElementById('creditRating').value = creditRating;
            document.getElementById('creditRatingDisplay').textContent = creditRatingText;
            
            // 关闭模态框
            var modal = bootstrap.Modal.getInstance(document.getElementById('creditRatingModal'));
            modal.hide();
        }

        // 重置表单
        function resetForm() {
            setTimeout(function() {
                // 移除所有选项的选择样式
                var options = document.querySelectorAll('.rating-option');
                for (var i = 0; i < options.length; i++) {
                    options[i].classList.remove('selected');
                }
                
                // 还原页面显示
                document.getElementById('resultSection').classList.add('d-none');
                document.getElementById('emptyResult').classList.remove('d-none');
                
                // 清除资信评分
                document.getElementById('creditRatingDisplay').textContent = "请填写资信评分表";
                document.getElementById('creditRating').value = "";
                creditRating = 0;
                creditRatingText = "请填写资信评分表";
            }, 100);
        }

        // 计算资信评分函数
        function calculateCreditScore() {
            var form = document.getElementById('creditRatingForm');
            var formData = new FormData(form);
            
            var totalScore = 0;
            var formValues = formData.values();
            for (var value of formValues) {
                totalScore += parseFloat(value);
            }
            
            // 确定资信等级
            var level, ratingValue;
            if (totalScore >= 90) {
                level = "优秀【90-100】";
                ratingValue = 25;
            } else if (totalScore >= 80) {
                level = "良好【80-89】";
                ratingValue = 20;
            } else if (totalScore >= 65) {
                level = "一般【65-79】";
                ratingValue = 15;
            } else {
                level = "较差【<65】";
                ratingValue = 5;
            }
            
            // 更新UI
            document.getElementById('creditTotalScore').textContent = totalScore.toFixed(0);
            document.getElementById('creditLevel').textContent = level;
            
            // 更新全局变量
            creditRating = ratingValue;
            creditRatingText = level + " (" + ratingValue + "分)";
        }
        
        // 计算总分函数
        function calculateTotalScore(e) {
            if (e) e.preventDefault();
            
            // 验证表单
            if (!document.getElementById('mainRatingForm').checkValidity()) {
                alert('请完整填写所有必填项！');
                return false;
            }
            
            // 验证资信评分是否已填写
            if (!document.getElementById('creditRating').value) {
                alert('请先填写客户资信评分表！');
                return false;
            }
            
            // 获取表单值
            var customerName = document.getElementById('customerName').value;
            var customerTypeOptions = document.getElementById('customerType');
            var customerType = customerTypeOptions.options[customerTypeOptions.selectedIndex].text;
            var customerTypeVal = customerTypeOptions.value;
            // 获取所有评分值
            var industryScore = parseFloat(getSelectedValue('industryType'));
            var businessTypeScore = parseFloat(getSelectedValue('businessType'));
            var influenceScore = parseFloat(getSelectedValue('influence'));
            var logisticsScaleScore = parseFloat(getSelectedValue('logisticsScale'));
            var profitEstimateScore = parseFloat(getSelectedValue('profitEstimate'));
            var creditScore = parseFloat(document.getElementById('creditRating').value);
            
            // 客户类型赋值（严格执行Excel标准）
            var customerTypeScore = 0;
            if (customerTypeVal === "direct") {
                customerTypeScore = 10;
            } else if (customerTypeVal === "global") {
                customerTypeScore = 8;
            } else if (customerTypeVal === "overseas") {
                customerTypeScore = 6;
            } else if (customerTypeVal === "peer") {
                customerTypeScore = 0;
            }
            
            // 计算总分
            var totalScore = industryScore + businessTypeScore + influenceScore + 
                             customerTypeScore + logisticsScaleScore + 
                             creditScore + profitEstimateScore;
            
            // 确定等级，考虑同行客户限制
            var level, message, alertClass;
            if (customerTypeVal === "peer") {
                level = 'C';
                message = '⚠️ 同行客户限制：根据规则，同行客户等级最高不超过C级';
                alertClass = 'alert-warning';
            } else {
                if (totalScore >= 90) {
                    level = 'A+';
                    message = '✅ 该客户评级为A+级，属于优质客户，推荐优先合作';
                    alertClass = 'alert-success';
                } else if (totalScore >= 80) {
                    level = 'A';
                    message = '📈 该客户评级为A级，属于良好客户，建议加强合作';
                    alertClass = 'alert-success';
                } else if (totalScore >= 70) {
                    level = 'B';
                    message = '⚠️ 该客户评级为B级，有一定的风险，需要谨慎评估';
                    alertClass = 'alert-warning';
                } else {
                    level = 'C';
                    message = '❗ 该客户评级为C级，高风险客户，需要领导审批';
                    alertClass = 'alert-danger';
                }
            }
            
            // 更新结果区域
            if (!customerName) customerName = '未填写';
            document.getElementById('resultCustomerName').textContent = customerName;
            document.getElementById('resultCustomerType').textContent = customerType;
            document.getElementById('resultIndustry').textContent = industryScore + '分';
            document.getElementById('resultBusinessType').textContent = businessTypeScore + '分';
            document.getElementById('resultInfluence').textContent = influenceScore + '分';
            document.getElementById('resultClientType').textContent = customerTypeScore + '分';
            document.getElementById('resultLogisticsScale').textContent = logisticsScaleScore + '分';
            document.getElementById('resultCredit').textContent = creditScore + '分';
            document.getElementById('resultProfit').textContent = profitEstimateScore + '分';
            document.getElementById('resultTotalScore').textContent = totalScore.toFixed(0) + '分';
            
            var gradeBadge = document.getElementById('resultGrade');
            gradeBadge.textContent = level;
            gradeBadge.className = 'level-badge ' + 
                (level === 'A+' ? 'a-plus-bg' : 
                 level === 'A' ? 'a-bg' :
                 level === 'B' ? 'b-bg' : 'c-bg');
            
            document.getElementById('resultMessageText').textContent = message;
            document.getElementById('resultMessage').className = 'alert ' + alertClass;
            
            // 显示结果区域
            document.getElementById('resultSection').classList.remove('d-none');
            document.getElementById('emptyResult').classList.add('d-none');
            
            return false;
        }
        
        // 获取单选按钮组的选中值
        function getSelectedValue(name) {
            var elements = document.getElementsByName(name);
            for (var i = 0; i < elements.length; i++) {
                if (elements[i].checked) {
                    return elements[i].value;
                }
            }
            return 0;
        }
        
        // Excel导出功能
        function exportToExcel() {
            if (!document.getElementById('resultCustomerName').textContent || 
                document.getElementById('resultSection').classList.contains('d-none')) {
                alert("请先计算分数再导出报告");
                return;
            }
            
            // 创建Workbook
            var wb = XLSX.utils.book_new();
            
            // 准备数据
            var ws_data = [
                ['售前项目客户评级报告', '', '', '', ''],
                ['客户名称', document.getElementById('resultCustomerName').textContent, '', '客户类型', document.getElementById('resultCustomerType').textContent],
                ['评估日期', new Date().toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' })],
                ['综合得分', document.getElementById('resultTotalScore').textContent, '', '客户等级', document.getElementById('resultGrade').textContent],
                ['评估结论', document.getElementById('resultMessageText').textContent],
                [],
                ['评估明细', '', '', '', ''],
                ['评估类别', '评估指标', '得分', '权重', '最终得分'],
                ['行业', document.querySelector('input[name="industryType"]:checked') ? document.querySelector('input[name="industryType"]:checked').parentNode.textContent.trim() : '未选择', 
                 document.getElementById('resultIndustry').textContent, '10%', document.getElementById('resultIndustry').textContent],
                ['业务类型', document.querySelector('input[name="businessType"]:checked') ? document.querySelector('input[name="businessType"]:checked').parentNode.textContent.trim() : '未选择',
                 document.getElementById('resultBusinessType').textContent, '15%', document.getElementById('resultBusinessType').textContent],
                ['客户影响力', document.querySelector('input[name="influence"]:checked') ? document.querySelector('input[name="influence"]:checked').parentNode.textContent.trim() : '未选择',
                 document.getElementById('resultInfluence').textContent, '10%', document.getElementById('resultInfluence').textContent],
                ['客户类型', document.getElementById('resultCustomerType').textContent,
                 document.getElementById('resultClientType').textContent, '10%', document.getElementById('resultClientType').textContent],
                ['客户规模', document.querySelector('input[name="logisticsScale"]:checked') ? document.querySelector('input[name="logisticsScale"]:checked').parentNode.textContent.trim() : '未选择',
                 document.getElementById('resultLogisticsScale').textContent, '10%', document.getElementById('resultLogisticsScale').textContent],
                ['资信评价', document.getElementById('creditRatingDisplay').textContent,
                 document.getElementById('resultCredit').textContent, '25%', document.getElementById('resultCredit').textContent],
                ['商机预估', document.querySelector('input[name="profitEstimate"]:checked') ? document.querySelector('input[name="profitEstimate"]:checked').parentNode.textContent.trim() : '未选择',
                 document.getElementById('resultProfit').textContent, '20%', document.getElementById('resultProfit').textContent],
            ];
            
            var ws = XLSX.utils.aoa_to_sheet(ws_data);
            
            // 设置样式（宽度）
            ws['!cols'] = [
                {wch: 15}, {wch: 25}, {wch: 8}, {wch: 8}, {wch: 15}
            ];
            
            XLSX.utils.book_append_sheet(wb, ws, "评级报告");
            
            // 导出文件
            var customerName = document.getElementById('customerName').value || '未命名客户';
            XLSX.writeFile(wb, '客户评级报告_' + customerName + '.xlsx');
        }
    </script>
</body>
</html>
